{"ast":null,"code":"import firebase from \"./firebase.js\";\nvar db = firebase.firestore();\nvar messaging = firebase.messaging(); // Add the public key generated from the console here.\n\nmessaging.usePublicVapidKey(\"BFVj_nB5KUhUpQbA1EYDPVHZIhs2awPNuZhM54OBS7bHk6DqYEmG6FRJdTurTS3Jp59OGCyA4RYTEcTBf1Hf5gY\");\nNotification.requestPermission().then(function (permission) {\n  if (permission === 'granted') {\n    console.log('Notification permission granted.'); // TODO(developer): Retrieve an Instance ID token for use with FCM.\n    // ...\n  } else {\n    console.log('Unable to get permission to notify.');\n  }\n}); // Get Instance ID token. Initially this makes a network call, once retrieved\n// subsequent calls to getToken will return from cache.\n\nmessaging.getToken().then(function (currentToken) {\n  if (currentToken) {\n    //console.log(currentToken);\n    SendTokenToServer(currentToken); //updateUIForPushEnabled(currentToken);\n  } else {\n    // Show permission request.\n    console.log('No Instance ID token available. Request permission to generate one.'); // Show permission UI.\n    //updateUIForPushPermissionRequired();\n    //setTokenSentToServer(false);\n  }\n}).catch(function (err) {\n  console.log('An error occurred while retrieving token. ', err); //showToken('Error retrieving Instance ID token. ', err);\n  //setTokenSentToServer(false);\n}); // Callback fired if Instance ID token is updated.\n\nmessaging.onTokenRefresh(function () {\n  messaging.getToken().then(function (refreshedToken) {\n    console.log('Token refreshed.'); //console.log(refreshedToken);\n\n    SendTokenToServer(refreshedToken); // Indicate that the new Instance ID token has not yet been sent to the\n    // app server.\n    //setTokenSentToServer(false);\n    // Send Instance ID token to app server.\n    // ...\n  }).catch(function (err) {\n    console.log('Unable to retrieve refreshed token ', err); //showToken('Unable to retrieve refreshed token ', err);\n  });\n});\n\nfunction SendTokenToServer(token) {\n  var user = firebase.auth().currentUser;\n\n  if (user) {\n    console.log(token);\n    db.collection(\"users\").doc(user.uid).set({\n      User_Token: token\n    });\n  }\n}\n\nmessaging.onMessage(function (payload) {\n  console.log(\"onMessage \", payload);\n});\nfirebase.auth().onAuthStateChanged(function (USER) {\n  var user = USER; //console.log(user);\n\n  if (user) {// User is signed in.\n  } else {// No user is signed in.\n    }\n});\nexport function GetUser() {\n  var user = firebase.auth().currentUser;\n  return user;\n}\nexport function GetUserData(currentComponent) {\n  var user = firebase.auth().currentUser;\n\n  if (user) {\n    var docRef = db.collection(\"users\").doc(user.uid);\n    docRef.get().then(function (doc) {\n      if (doc && doc.exists) {\n        //console.log(doc);\n        var data = doc.data(); //console.log(data);\n\n        currentComponent.setState({\n          User: user,\n          User_Loaded: true,\n          User_Firstname: data.User_Firstname,\n          User_Lastname: data.User_Lastname,\n          User_Email: data.User_Email,\n          User_Friends: data.User_Friends\n        });\n      }\n    }).catch(function (error) {\n      // Handle Errors here.\n      var errorCode = error.code;\n      var errorMessage = error.message; // ...\n\n      alert(\"Error Code: \" + errorCode + \"\\n\" + errorMessage);\n    });\n  } else {\n    currentComponent.setState({\n      User: null,\n      User_Loaded: false,\n      User_Firstname: \"\",\n      User_Lastname: \"\",\n      User_Email: \"\",\n      User_Friends: \"\"\n    });\n  }\n}\nexport function CreateUser(firstname, lastname, email, password, props) {\n  firebase.auth().createUserWithEmailAndPassword(email, password).then(function (cred) {\n    return db.collection(\"users\").doc(cred.user.uid).set({\n      User_Firstname: firstname,\n      User_Lastname: lastname,\n      User_Email: email,\n      User_Friends: []\n    });\n  }).then(function () {\n    //create user successful\n    alert(\"Created User\");\n    props.history.push(\"/userpage\");\n  }).catch(function (error) {\n    // Handle Errors here.\n    var errorCode = error.code;\n    var errorMessage = error.message; // ...\n\n    alert(\"Error Code: \" + errorCode + \"\\n\" + errorMessage);\n  });\n}\nexport function Login(email, password, props) {\n  firebase.auth().signInWithEmailAndPassword(email, password).then(function () {\n    //sign in successful\n    alert(\"Logged In\");\n    props.history.push(\"/userpage\");\n  }).catch(function (error) {\n    // Handle Errors here.\n    var errorCode = error.code;\n    var errorMessage = error.message; // ...\n\n    alert(\"Error Code: \" + errorCode + \"\\n\" + errorMessage);\n  });\n}\nexport function Logout(props) {\n  firebase.auth().signOut().then(function () {\n    // Sign-out successful.\n    alert(\"Logged Out\");\n    props.history.push(\"/login\");\n  }).catch(function (error) {\n    // An error happened.\n    var errorCode = error.code;\n    var errorMessage = error.message;\n    alert(\"Error Code: \" + errorCode + \"\\n\" + errorMessage);\n  });\n}","map":{"version":3,"sources":["D:\\Documents\\CS 180 Software Engineering\\DJ-IRS\\src\\UserFunctions.js"],"names":["firebase","db","firestore","messaging","usePublicVapidKey","Notification","requestPermission","then","permission","console","log","getToken","currentToken","SendTokenToServer","catch","err","onTokenRefresh","refreshedToken","token","user","auth","currentUser","collection","doc","uid","set","User_Token","onMessage","payload","onAuthStateChanged","USER","GetUser","GetUserData","currentComponent","docRef","get","exists","data","setState","User","User_Loaded","User_Firstname","User_Lastname","User_Email","User_Friends","error","errorCode","code","errorMessage","message","alert","CreateUser","firstname","lastname","email","password","props","createUserWithEmailAndPassword","cred","history","push","Login","signInWithEmailAndPassword","Logout","signOut"],"mappings":"AAAA,OAAOA,QAAP,MAAqB,eAArB;AAEA,IAAIC,EAAE,GAAGD,QAAQ,CAACE,SAAT,EAAT;AAKA,IAAMC,SAAS,GAAGH,QAAQ,CAACG,SAAT,EAAlB,C,CACA;;AACAA,SAAS,CAACC,iBAAV,CAA4B,yFAA5B;AAGAC,YAAY,CAACC,iBAAb,GAAiCC,IAAjC,CAAsC,UAASC,UAAT,EAAqB;AACzD,MAAIA,UAAU,KAAK,SAAnB,EAA8B;AAC5BC,IAAAA,OAAO,CAACC,GAAR,CAAY,kCAAZ,EAD4B,CAE5B;AACA;AACD,GAJD,MAIO;AACLD,IAAAA,OAAO,CAACC,GAAR,CAAY,qCAAZ;AACD;AACF,CARD,E,CAUA;AACA;;AACAP,SAAS,CAACQ,QAAV,GAAqBJ,IAArB,CAA0B,UAASK,YAAT,EAAuB;AAC/C,MAAIA,YAAJ,EAAkB;AAChB;AACAC,IAAAA,iBAAiB,CAACD,YAAD,CAAjB,CAFgB,CAGhB;AAED,GALD,MAKO;AACL;AACAH,IAAAA,OAAO,CAACC,GAAR,CAAY,qEAAZ,EAFK,CAGL;AACA;AACA;AACD;AACF,CAbD,EAaGI,KAbH,CAaS,UAASC,GAAT,EAAc;AACrBN,EAAAA,OAAO,CAACC,GAAR,CAAY,4CAAZ,EAA0DK,GAA1D,EADqB,CAErB;AACA;AACD,CAjBD,E,CAmBA;;AACAZ,SAAS,CAACa,cAAV,CAAyB,YAAW;AAClCb,EAAAA,SAAS,CAACQ,QAAV,GAAqBJ,IAArB,CAA0B,UAASU,cAAT,EAAyB;AACjDR,IAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ,EADiD,CAEjD;;AACAG,IAAAA,iBAAiB,CAACI,cAAD,CAAjB,CAHiD,CAIjD;AACA;AACA;AACA;AACA;AACD,GATD,EASGH,KATH,CASS,UAASC,GAAT,EAAc;AACrBN,IAAAA,OAAO,CAACC,GAAR,CAAY,qCAAZ,EAAmDK,GAAnD,EADqB,CAErB;AACD,GAZD;AAaD,CAdD;;AAkBA,SAASF,iBAAT,CAA2BK,KAA3B,EAAkC;AAChC,MAAIC,IAAI,GAAGnB,QAAQ,CAACoB,IAAT,GAAgBC,WAA3B;;AACA,MAAGF,IAAH,EAAS;AACPV,IAAAA,OAAO,CAACC,GAAR,CAAYQ,KAAZ;AACAjB,IAAAA,EAAE,CAACqB,UAAH,CAAc,OAAd,EAAuBC,GAAvB,CAA2BJ,IAAI,CAACK,GAAhC,EAAqCC,GAArC,CAAyC;AACvCC,MAAAA,UAAU,EAAER;AAD2B,KAAzC;AAGD;AAEF;;AAIDf,SAAS,CAACwB,SAAV,CAAoB,UAAUC,OAAV,EAAmB;AACrCnB,EAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ,EAA0BkB,OAA1B;AACD,CAFD;AAYA5B,QAAQ,CAACoB,IAAT,GAAgBS,kBAAhB,CAAmC,UAASC,IAAT,EAAe;AAChD,MAAIX,IAAI,GAAGW,IAAX,CADgD,CAE9C;;AAEA,MAAIX,IAAJ,EAAU,CACR;AAGD,GAJD,MAIO,CACL;AACD;AACJ,CAXD;AAeA,OAAO,SAASY,OAAT,GAAmB;AACxB,MAAIZ,IAAI,GAAGnB,QAAQ,CAACoB,IAAT,GAAgBC,WAA3B;AACA,SAAOF,IAAP;AACD;AAQD,OAAO,SAASa,WAAT,CAAqBC,gBAArB,EAAuC;AAC5C,MAAId,IAAI,GAAGnB,QAAQ,CAACoB,IAAT,GAAgBC,WAA3B;;AAEE,MAAGF,IAAH,EAAS;AACP,QAAIe,MAAM,GAAGjC,EAAE,CAACqB,UAAH,CAAc,OAAd,EAAuBC,GAAvB,CAA2BJ,IAAI,CAACK,GAAhC,CAAb;AACAU,IAAAA,MAAM,CAACC,GAAP,GAAa5B,IAAb,CAAmB,UAASgB,GAAT,EAAc;AAC/B,UAAGA,GAAG,IAAIA,GAAG,CAACa,MAAd,EAAsB;AACpB;AACA,YAAMC,IAAI,GAAGd,GAAG,CAACc,IAAJ,EAAb,CAFoB,CAGpB;;AACAJ,QAAAA,gBAAgB,CAACK,QAAjB,CAA2B;AACzBC,UAAAA,IAAI,EAAEpB,IADmB;AAEzBqB,UAAAA,WAAW,EAAE,IAFY;AAGzBC,UAAAA,cAAc,EAAEJ,IAAI,CAACI,cAHI;AAIzBC,UAAAA,aAAa,EAAEL,IAAI,CAACK,aAJK;AAKzBC,UAAAA,UAAU,EAAEN,IAAI,CAACM,UALQ;AAMzBC,UAAAA,YAAY,EAAEP,IAAI,CAACO;AANM,SAA3B;AAQD;AACF,KAdD,EAcG9B,KAdH,CAcS,UAAS+B,KAAT,EAAgB;AACvB;AACA,UAAIC,SAAS,GAAGD,KAAK,CAACE,IAAtB;AACA,UAAIC,YAAY,GAAGH,KAAK,CAACI,OAAzB,CAHuB,CAIvB;;AAEAC,MAAAA,KAAK,CAAC,iBAAiBJ,SAAjB,GAA6B,IAA7B,GAAoCE,YAArC,CAAL;AACD,KArBD;AAuBD,GAzBD,MAyBM;AACJf,IAAAA,gBAAgB,CAACK,QAAjB,CAA2B;AACzBC,MAAAA,IAAI,EAAE,IADmB;AAEzBC,MAAAA,WAAW,EAAE,KAFY;AAGzBC,MAAAA,cAAc,EAAE,EAHS;AAIzBC,MAAAA,aAAa,EAAE,EAJU;AAKzBC,MAAAA,UAAU,EAAE,EALa;AAMzBC,MAAAA,YAAY,EAAE;AANW,KAA3B;AAQD;AAGJ;AAOD,OAAO,SAASO,UAAT,CAAoBC,SAApB,EAA+BC,QAA/B,EAAyCC,KAAzC,EAAgDC,QAAhD,EAA0DC,KAA1D,EAAiE;AAChExD,EAAAA,QAAQ,CAACoB,IAAT,GAAgBqC,8BAAhB,CAA+CH,KAA/C,EAAsDC,QAAtD,EAAgEhD,IAAhE,CAAqE,UAAAmD,IAAI,EAAI;AAC3E,WAAOzD,EAAE,CAACqB,UAAH,CAAc,OAAd,EAAuBC,GAAvB,CAA2BmC,IAAI,CAACvC,IAAL,CAAUK,GAArC,EAA0CC,GAA1C,CAA8C;AACnDgB,MAAAA,cAAc,EAAEW,SADmC;AAEnDV,MAAAA,aAAa,EAAEW,QAFoC;AAGnDV,MAAAA,UAAU,EAAEW,KAHuC;AAInDV,MAAAA,YAAY,EAAE;AAJqC,KAA9C,CAAP;AAOD,GARD,EAQGrC,IARH,CAQS,YAAW;AAChB;AACA2C,IAAAA,KAAK,CAAC,cAAD,CAAL;AACAM,IAAAA,KAAK,CAACG,OAAN,CAAcC,IAAd,CAAmB,WAAnB;AACH,GAZD,EAYG9C,KAZH,CAYS,UAAS+B,KAAT,EAAgB;AACrB;AACA,QAAIC,SAAS,GAAGD,KAAK,CAACE,IAAtB;AACA,QAAIC,YAAY,GAAGH,KAAK,CAACI,OAAzB,CAHqB,CAIrB;;AAEAC,IAAAA,KAAK,CAAC,iBAAiBJ,SAAjB,GAA6B,IAA7B,GAAoCE,YAArC,CAAL;AAED,GApBH;AAqBP;AAUD,OAAO,SAASa,KAAT,CAAeP,KAAf,EAAsBC,QAAtB,EAAgCC,KAAhC,EAAuC;AAC1CxD,EAAAA,QAAQ,CAACoB,IAAT,GAAgB0C,0BAAhB,CAA2CR,KAA3C,EAAkDC,QAAlD,EAA4DhD,IAA5D,CAAiE,YAAW;AAC1E;AACA2C,IAAAA,KAAK,CAAC,WAAD,CAAL;AACAM,IAAAA,KAAK,CAACG,OAAN,CAAcC,IAAd,CAAmB,WAAnB;AAED,GALD,EAKG9C,KALH,CAKS,UAAS+B,KAAT,EAAgB;AACrB;AACA,QAAIC,SAAS,GAAGD,KAAK,CAACE,IAAtB;AACA,QAAIC,YAAY,GAAGH,KAAK,CAACI,OAAzB,CAHqB,CAIrB;;AAEAC,IAAAA,KAAK,CAAC,iBAAiBJ,SAAjB,GAA6B,IAA7B,GAAoCE,YAArC,CAAL;AACD,GAZH;AAcH;AAaD,OAAO,SAASe,MAAT,CAAgBP,KAAhB,EAAuB;AAExBxD,EAAAA,QAAQ,CAACoB,IAAT,GAAgB4C,OAAhB,GAA0BzD,IAA1B,CAA+B,YAAW;AACxC;AACA2C,IAAAA,KAAK,CAAC,YAAD,CAAL;AACAM,IAAAA,KAAK,CAACG,OAAN,CAAcC,IAAd,CAAmB,QAAnB;AAED,GALD,EAKG9C,KALH,CAKS,UAAS+B,KAAT,EAAgB;AACvB;AACA,QAAIC,SAAS,GAAGD,KAAK,CAACE,IAAtB;AACA,QAAIC,YAAY,GAAGH,KAAK,CAACI,OAAzB;AACAC,IAAAA,KAAK,CAAC,iBAAiBJ,SAAjB,GAA6B,IAA7B,GAAoCE,YAArC,CAAL;AACD,GAVD;AAaL","sourcesContent":["import firebase from \"./firebase.js\";\r\n\r\nvar db = firebase.firestore();\r\n\r\n\r\n\r\n\r\nconst messaging = firebase.messaging();\r\n// Add the public key generated from the console here.\r\nmessaging.usePublicVapidKey(\"BFVj_nB5KUhUpQbA1EYDPVHZIhs2awPNuZhM54OBS7bHk6DqYEmG6FRJdTurTS3Jp59OGCyA4RYTEcTBf1Hf5gY\");\r\n\r\n\r\nNotification.requestPermission().then(function(permission) {\r\n  if (permission === 'granted') {\r\n    console.log('Notification permission granted.');\r\n    // TODO(developer): Retrieve an Instance ID token for use with FCM.\r\n    // ...\r\n  } else {\r\n    console.log('Unable to get permission to notify.');\r\n  }\r\n});\r\n\r\n// Get Instance ID token. Initially this makes a network call, once retrieved\r\n// subsequent calls to getToken will return from cache.\r\nmessaging.getToken().then(function(currentToken) {\r\n  if (currentToken) {\r\n    //console.log(currentToken);\r\n    SendTokenToServer(currentToken);\r\n    //updateUIForPushEnabled(currentToken);\r\n    \r\n  } else {\r\n    // Show permission request.\r\n    console.log('No Instance ID token available. Request permission to generate one.');\r\n    // Show permission UI.\r\n    //updateUIForPushPermissionRequired();\r\n    //setTokenSentToServer(false);\r\n  }\r\n}).catch(function(err) {\r\n  console.log('An error occurred while retrieving token. ', err);\r\n  //showToken('Error retrieving Instance ID token. ', err);\r\n  //setTokenSentToServer(false);\r\n});\r\n\r\n// Callback fired if Instance ID token is updated.\r\nmessaging.onTokenRefresh(function() {\r\n  messaging.getToken().then(function(refreshedToken) {\r\n    console.log('Token refreshed.');\r\n    //console.log(refreshedToken);\r\n    SendTokenToServer(refreshedToken);\r\n    // Indicate that the new Instance ID token has not yet been sent to the\r\n    // app server.\r\n    //setTokenSentToServer(false);\r\n    // Send Instance ID token to app server.\r\n    // ...\r\n  }).catch(function(err) {\r\n    console.log('Unable to retrieve refreshed token ', err);\r\n    //showToken('Unable to retrieve refreshed token ', err);\r\n  });\r\n});\r\n\r\n\r\n\r\nfunction SendTokenToServer(token) {\r\n  var user = firebase.auth().currentUser;\r\n  if(user) {\r\n    console.log(token);\r\n    db.collection(\"users\").doc(user.uid).set({\r\n      User_Token: token\r\n    });\r\n  }\r\n  \r\n}\r\n\r\n\r\n\r\nmessaging.onMessage(function (payload) {\r\n  console.log(\"onMessage \", payload);\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nfirebase.auth().onAuthStateChanged(function(USER) {\r\n  var user = USER;\r\n    //console.log(user);\r\n\r\n    if (user) {\r\n      // User is signed in.\r\n        \r\n\r\n    } else {\r\n      // No user is signed in.\r\n    }\r\n});\r\n\r\n\r\n\r\nexport function GetUser() {\r\n  var user = firebase.auth().currentUser;\r\n  return user;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nexport function GetUserData(currentComponent) {\r\n  var user = firebase.auth().currentUser;\r\n\r\n    if(user) {\r\n      var docRef = db.collection(\"users\").doc(user.uid);\r\n      docRef.get().then( function(doc) {\r\n        if(doc && doc.exists) {\r\n          //console.log(doc);\r\n          const data = doc.data();\r\n          //console.log(data);\r\n          currentComponent.setState( {\r\n            User: user,\r\n            User_Loaded: true,\r\n            User_Firstname: data.User_Firstname,\r\n            User_Lastname: data.User_Lastname,\r\n            User_Email: data.User_Email,\r\n            User_Friends: data.User_Friends,\r\n          });\r\n        }\r\n      }).catch(function(error) {\r\n        // Handle Errors here.\r\n        var errorCode = error.code;\r\n        var errorMessage = error.message;\r\n        // ...\r\n\r\n        alert(\"Error Code: \" + errorCode + \"\\n\" + errorMessage);\r\n      });\r\n      \r\n    }else {\r\n      currentComponent.setState( {\r\n        User: null,\r\n        User_Loaded: false,\r\n        User_Firstname: \"\",\r\n        User_Lastname: \"\",\r\n        User_Email: \"\",\r\n        User_Friends: \"\",\r\n      });\r\n    }\r\n    \r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\nexport function CreateUser(firstname, lastname, email, password, props) {\r\n        firebase.auth().createUserWithEmailAndPassword(email, password).then(cred => {\r\n          return db.collection(\"users\").doc(cred.user.uid).set({\r\n            User_Firstname: firstname,\r\n            User_Lastname: lastname,\r\n            User_Email: email,\r\n            User_Friends: [],\r\n          });\r\n          \r\n        }).then( function() {\r\n            //create user successful\r\n            alert(\"Created User\");\r\n            props.history.push(\"/userpage\");\r\n        }).catch(function(error) {\r\n            // Handle Errors here.\r\n            var errorCode = error.code;\r\n            var errorMessage = error.message;\r\n            // ...\r\n\r\n            alert(\"Error Code: \" + errorCode + \"\\n\" + errorMessage);\r\n\r\n          });\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nexport function Login(email, password, props) {\r\n    firebase.auth().signInWithEmailAndPassword(email, password).then(function() {\r\n      //sign in successful\r\n      alert(\"Logged In\");\r\n      props.history.push(\"/userpage\");\r\n      \r\n    }).catch(function(error) {\r\n        // Handle Errors here.\r\n        var errorCode = error.code;\r\n        var errorMessage = error.message;\r\n        // ...\r\n\r\n        alert(\"Error Code: \" + errorCode + \"\\n\" + errorMessage);\r\n      });\r\n      \r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nexport function Logout(props) {\r\n    \r\n      firebase.auth().signOut().then(function() {\r\n        // Sign-out successful.\r\n        alert(\"Logged Out\");\r\n        props.history.push(\"/login\");\r\n        \r\n      }).catch(function(error) {\r\n        // An error happened.\r\n        var errorCode = error.code;\r\n        var errorMessage = error.message;\r\n        alert(\"Error Code: \" + errorCode + \"\\n\" + errorMessage);\r\n      });\r\n      \r\n      \r\n}\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}